{% extends "admin/admin_base.html" %}
{% block title %}Manage Gadgets{% endblock %}

{% block content %}

<h2 class="text-3xl font-bold mb-8 text-gray-800 tracking-wide">ğŸ›  Manage Gadgets</h2>

<!-- ADD NEW BUTTON -->
<div class="mb-6">
    <a href="{{ url_for('admin_add_gadget') }}"
       class="px-5 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow hover:bg-blue-700 transition">
       â• Add New Gadget
    </a>
</div>

{% if gadgets %}

{% set featured = gadgets | selectattr("is_featured") | list %}
{% set non_featured = gadgets | rejectattr("is_featured") | list %}

<!-- ====================================================== -->
<!-- â­ LISTING TABLE (Desktop & Tablet) -->
<!-- ====================================================== -->

<div class="overflow-x-auto shadow-xl rounded-xl border border-gray-200 hidden md:block">
    <table class="min-w-full bg-white text-sm">
        <thead class="bg-blue-600 text-white">
            <tr>
                <th class="py-3 px-4 text-left">ID</th>
                <th class="py-3 px-4 text-left">Image</th>
                <th class="py-3 px-4 text-left">Name</th>
                <th class="py-3 px-4 text-left">Category</th>
                <th class="py-3 px-4 text-left">Price/Day</th>
                <th class="py-3 px-4 text-left">Stock</th>
                <th class="py-3 px-4 text-left">Featured</th>
                <th class="py-3 px-4 text-left">Active</th>
                <th class="py-3 px-4 text-left">Actions</th>
            </tr>
        </thead>

        <tbody>

            <!-- â­ FEATURED SECTION -->
            {% if featured %}
            <tr class="bg-yellow-50">
                <td colspan="9" class="py-2 px-4 font-semibold text-yellow-700 text-sm">
                    â­ FEATURED GADGETS
                </td>
            </tr>

            {% for gadget in featured %}
            <tr class="hover:bg-gray-50 transition border-b">

                <!-- ID -->
                <td class="py-3 px-4 font-semibold text-gray-700">#{{ gadget.id }}</td>

                <!-- IMAGE -->
                <td class="py-3 px-4">
                    <img src="{{ url_for('static', filename=gadget.image) if gadget.image else url_for('static', filename='default_gadget.png') }}"
                         alt="{{ gadget.name }}"
                         class="w-14 h-14 object-cover rounded-lg border shadow-sm">
                </td>

                <!-- NAME -->
                <td class="py-3 px-4 font-medium text-blue-600">{{ gadget.name }}</td>

                <!-- CATEGORY -->
                <td class="py-3 px-4 text-gray-700">{{ gadget.category }}</td>

                <!-- PRICE -->
                <td class="py-3 px-4">â‚¹{{ "%.2f"|format(gadget.price_per_day) }}</td>

                <!-- STOCK BADGE -->
                <td class="py-3 px-4">
                    <span class="
                        px-3 py-1 rounded-full text-xs font-semibold
                        {% if gadget.stock > 5 %} bg-green-100 text-green-700
                        {% elif gadget.stock > 0 %} bg-yellow-100 text-yellow-700
                        {% else %} bg-red-100 text-red-700
                        {% endif %}
                    ">
                        {{ gadget.stock }}
                    </span>
                </td>

                <!-- FEATURED BADGE -->
                <td class="py-3 px-4">
                    <span class="px-3 py-1 rounded-full bg-yellow-100 text-yellow-700 text-xs font-semibold flex items-center gap-1">
                         YES
                    </span>
                </td>

                <!-- ACTIVE STATUS -->
                <td class="py-3 px-4">
                    <span class="
                        px-3 py-1 rounded-full text-xs font-semibold
                        {% if gadget.is_active %} bg-green-100 text-green-700
                        {% else %} bg-red-100 text-red-700
                        {% endif %}
                    ">
                        {{ 'Active' if gadget.is_active else 'Inactive' }}
                    </span>
                </td>

                <!-- ACTION BUTTONS -->
                <td class="py-3 px-4">
                    <div class="flex items-center gap-4">

                        <!-- Edit -->
                        <a href="{{ url_for('admin_edit_gadget', gadget_id=gadget.id) }}"
                           class="text-blue-600 hover:text-blue-800 font-semibold flex items-center gap-1">
                           âœ Edit
                        </a>

                        <!-- Remove Featured -->
                        <a href="{{ url_for('admin_toggle_featured', gadget_id=gadget.id) }}"
                           class="text-yellow-600 hover:text-yellow-800 font-semibold flex items-center gap-1">
                           â­ Remove
                        </a>

                        <!-- Delete -->
                        <form action="{{ url_for('admin_delete_gadget', gadget_id=gadget.id) }}" method="POST">
                            <button type="submit"
                                onclick="return confirm('Delete {{ gadget.name }}?');"
                                class="text-red-600 hover:text-red-800 font-semibold flex items-center gap-1">
                                ğŸ—‘ Delete
                            </button>
                        </form>

                    </div>
                </td>

            </tr>
            {% endfor %}
            {% endif %}

            <!-- ğŸ“¦ NON-FEATURED SECTION -->
            <tr class="bg-gray-100">
                <td colspan="9" class="py-2 px-4 font-semibold text-gray-800 text-sm">
                    ğŸ“¦ ALL OTHER GADGETS
                </td>
            </tr>

            {% for gadget in non_featured %}
            <tr class="hover:bg-gray-50 transition border-b">

                <td class="py-3 px-4 font-semibold text-gray-700">#{{ gadget.id }}</td>

                <td class="py-3 px-4">
                    <img src="{{ url_for('static', filename=gadget.image) if gadget.image else url_for('static', filename='default_gadget.png') }}"
                         alt="{{ gadget.name }}"
                         class="w-14 h-14 object-cover rounded-lg border shadow-sm">
                </td>

                <td class="py-3 px-4 font-medium text-blue-600">{{ gadget.name }}</td>

                <td class="py-3 px-4">{{ gadget.category }}</td>

                <td class="py-3 px-4">â‚¹{{ "%.2f"|format(gadget.price_per_day) }}</td>

                <td class="py-3 px-4">
                    <span class="
                        px-3 py-1 rounded-full text-xs font-semibold
                        {% if gadget.stock > 5 %} bg-green-100 text-green-700
                        {% elif gadget.stock > 0 %} bg-yellow-100 text-yellow-700
                        {% else %} bg-red-100 text-red-700
                        {% endif %}
                    ">
                        {{ gadget.stock }}
                    </span>
                </td>

                <!-- NOT FEATURED -->
                <td class="py-3 px-4">
                    <span class="px-3 py-1 rounded-full bg-gray-200 text-gray-700 text-xs font-semibold">
                        NO
                    </span>
                </td>

                <!-- ACTIVE BADGE -->
                <td class="py-3 px-4">
                    <span class="
                        px-3 py-1 rounded-full text-xs font-semibold
                        {% if gadget.is_active %} bg-green-100 text-green-700
                        {% else %} bg-red-100 text-red-700
                        {% endif %}
                    ">
                        {{ 'Active' if gadget.is_active else 'Inactive' }}
                    </span>
                </td>

                <!-- ACTION BUTTONS -->
                <td class="py-3 px-4">
                    <div class="flex items-center gap-4">

                        <a href="{{ url_for('admin_edit_gadget', gadget_id=gadget.id) }}"
                           class="text-blue-600 hover:text-blue-800 font-semibold flex items-center gap-1">
                            âœ Edit
                        </a>

                        <a href="{{ url_for('admin_toggle_featured', gadget_id=gadget.id) }}"
                           class="text-yellow-600 hover:text-yellow-800 font-semibold flex items-center gap-1">
                            â­ Make Featured
                        </a>

                        <form action="{{ url_for('admin_delete_gadget', gadget_id=gadget.id) }}" method="POST">
                            <button type="submit"
                                onclick="return confirm('Delete {{ gadget.name }}?');"
                                class="text-red-600 hover:text-red-800 font-semibold flex items-center gap-1">
                                ğŸ—‘ Delete
                            </button>
                        </form>

                    </div>
                </td>

            </tr>
            {% endfor %}

        </tbody>
    </table>
    </table>
</div>

<!-- ====================================================== -->
<!-- ğŸ“± MOBILE CARD VIEW -->
<!-- ====================================================== -->
<div class="md:hidden space-y-4">

    <!-- Featured on mobile -->
    {% if featured %}
    <h3 class="text-sm font-semibold text-yellow-700">â­ Featured Gadgets</h3>
    {% for gadget in featured %}
    <div class="bg-white rounded-xl shadow border border-gray-200 p-4 flex gap-4">
        <img src="{{ url_for('static', filename=gadget.image) if gadget.image else url_for('static', filename='default_gadget.png') }}"
             alt="{{ gadget.name }}"
             class="w-20 h-20 object-cover rounded-lg border">
        <div class="flex-1 space-y-1">
            <div class="flex items-center justify-between">
                <p class="font-semibold text-blue-700 text-sm line-clamp-2">{{ gadget.name }}</p>
                <span class="text-xs text-gray-500">#{{ gadget.id }}</span>
            </div>
            <p class="text-xs text-gray-600">{{ gadget.category }}</p>
            <p class="text-sm font-semibold text-gray-800">â‚¹{{ '%.2f'|format(gadget.price_per_day) }}/day</p>
            <div class="flex flex-wrap items-center gap-2 mt-1">
                <span class="px-2 py-0.5 rounded-full text-[10px] font-semibold
                    {% if gadget.stock > 5 %} bg-green-100 text-green-700
                    {% elif gadget.stock > 0 %} bg-yellow-100 text-yellow-700
                    {% else %} bg-red-100 text-red-700
                    {% endif %}">
                    Stock: {{ gadget.stock }}
                </span>
                <span class="px-2 py-0.5 rounded-full text-[10px] font-semibold bg-yellow-100 text-yellow-700">
                    Featured
                </span>
                <span class="px-2 py-0.5 rounded-full text-[10px] font-semibold
                    {% if gadget.is_active %} bg-green-100 text-green-700
                    {% else %} bg-red-100 text-red-700
                    {% endif %}">
                    {{ 'Active' if gadget.is_active else 'Inactive' }}
                </span>
            </div>
            <div class="flex flex-wrap gap-3 mt-3 text-xs">
                <a href="{{ url_for('admin_edit_gadget', gadget_id=gadget.id) }}"
                   class="px-3 py-1 rounded bg-blue-50 text-blue-700 font-semibold">
                    âœ Edit
                </a>
                <a href="{{ url_for('admin_toggle_featured', gadget_id=gadget.id) }}"
                   class="px-3 py-1 rounded bg-yellow-50 text-yellow-700 font-semibold">
                    â­ Remove
                </a>
                <form action="{{ url_for('admin_delete_gadget', gadget_id=gadget.id) }}" method="POST" class="inline">
                    <button type="submit"
                            onclick="return confirm('Delete {{ gadget.name }}?');"
                            class="px-3 py-1 rounded bg-red-50 text-red-700 font-semibold">
                        ğŸ—‘ Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
    {% endif %}

    <!-- Non-featured on mobile -->
    <h3 class="text-sm font-semibold text-gray-800 mt-4">ğŸ“¦ All Other Gadgets</h3>
    {% for gadget in non_featured %}
    <div class="bg-white rounded-xl shadow border border-gray-200 p-4 flex gap-4">
        <img src="{{ url_for('static', filename=gadget.image) if gadget.image else url_for('static', filename='default_gadget.png') }}"
             alt="{{ gadget.name }}"
             class="w-20 h-20 object-cover rounded-lg border">
        <div class="flex-1 space-y-1">
            <div class="flex items-center justify-between">
                <p class="font-semibold text-blue-700 text-sm line-clamp-2">{{ gadget.name }}</p>
                <span class="text-xs text-gray-500">#{{ gadget.id }}</span>
            </div>
            <p class="text-xs text-gray-600">{{ gadget.category }}</p>
            <p class="text-sm font-semibold text-gray-800">â‚¹{{ '%.2f'|format(gadget.price_per_day) }}/day</p>
            <div class="flex flex-wrap items-center gap-2 mt-1">
                <span class="px-2 py-0.5 rounded-full text-[10px] font-semibold
                    {% if gadget.stock > 5 %} bg-green-100 text-green-700
                    {% elif gadget.stock > 0 %} bg-yellow-100 text-yellow-700
                    {% else %} bg-red-100 text-red-700
                    {% endif %}">
                    Stock: {{ gadget.stock }}
                </span>
                <span class="px-2 py-0.5 rounded-full text-[10px] font-semibold
                    {% if gadget.is_active %} bg-green-100 text-green-700
                    {% else %} bg-red-100 text-red-700
                    {% endif %}">
                    {{ 'Active' if gadget.is_active else 'Inactive' }}
                </span>
            </div>
            <div class="flex flex-wrap gap-3 mt-3 text-xs">
                <a href="{{ url_for('admin_edit_gadget', gadget_id=gadget.id) }}"
                   class="px-3 py-1 rounded bg-blue-50 text-blue-700 font-semibold">
                    âœ Edit
                </a>
                <a href="{{ url_for('admin_toggle_featured', gadget_id=gadget.id) }}"
                   class="px-3 py-1 rounded bg-yellow-50 text-yellow-700 font-semibold">
                    â­ Make Featured
                </a>
                <form action="{{ url_for('admin_delete_gadget', gadget_id=gadget.id) }}" method="POST" class="inline">
                    <button type="submit"
                            onclick="return confirm('Delete {{ gadget.name }}?');"
                            class="px-3 py-1 rounded bg-red-50 text-red-700 font-semibold">
                        ğŸ—‘ Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% else %}
<p class="text-center text-gray-500 text-lg font-medium py-8">No gadgets found.</p>
{% endif %}

{% endblock %}
